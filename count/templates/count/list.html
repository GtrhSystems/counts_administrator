{% extends "layout.html" %}
{% block page_header %}
Listado de Cuentas
{% endblock %}
{% load widget_tweaks %}
{% block content %}
<div class="col-lg-12 grid-margin stretch-card">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Cuentas</h4>
      <p class="card-description"><code></code>
      </p>
      <div class="table-responsive">
        <table class="table table-dark table-normal table-list_count">
          <thead>
            <tr>
              <th>#</th>
              <th> Plataforma </th>
              <th> Cliente </th>
              <th> Correo </th>
              <th> Perfiles </th>
              <th> Contraseña </th>
              <th> Vence </th>
              <th>  </th>
            </tr>
          </thead>
          <tbody>
           {% for bill in object_list %}
            <tr>
              <td>{{forloop.counter}}</td>
              <td>{{ bill.customer.name }}</td>
              <td>{{ bill.sale.profile.count.platform.name }}</td>
              <td>{{ bill.sale.profile.count.email }}</td>
              <td>{{ bill.len }}</td>
              <td>{{ bill.sale.profile.count.password }}</td>
              <td>{{ bill.sale.date_limit|date:"d/M/Y" }} ({{ bill.rest_days }}) </td>
              <td>
              {% if perms.count.change_count %}
                <button type="button" id_count="{{ bill.sale.profile.count.id }}" class="btn btn-primary btn-fw change-password">Cambiar contraseña</button>
              {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
$(".table-list_count").on("click", ".change-password" , function(){
    count_id = $(this).attr('id_count')
    $.get('/count/change-password/'+count_id)
      .done(function( data ) {
            $('.modal-body').html(data)
            $('.modal-title').text("Respuesta de la solicitud")
            $('.modal-footer').hide()
            $("#myModal").modal({show: true})
            $('.change-pass').click(function(e){
              e.preventDefault()
              json = convertFormToJSON($('.change-password-form'))
              $.post('/count/change-password/'+count_id, json)
                .done(function( data ) {
                  $('.modal-body').html(data)
              })
            })
            $("#myModal").on('hide.bs.modal', function (e) {
              location.reload();
            });
        });

})
</script>
{% endblock %}