{% extends "layout.html" %}
{% block page_header %}
Listado de Cuentas Proximas a Expirar
{% endblock %}
{% load widget_tweaks %}
{% block content %}
<style>
.modal-content{
     height: 300px;
}


.hide {
  position: absolute;
    top: 18%;
    left: 37%;
    #transform: translate(-50%, -50%);
    z-index: 1113;
}

</style>
<div class="col-lg-12 grid-margin stretch-card">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Cuentas</h4>
      <p class="card-description"><code></code>
      </p>
      <form  method="post" class="forms-sample sales" >
      {% csrf_token %}
      <div class="table-responsive">
        <table class="table table-dark table-normal">
          <thead>
            <tr>
              <th>#</th>
              <th> Plataforma </th>
              <th> Cliente </th>
              <th> Correo </th>
              <th> Contraseña </th>
              <th> Perfil </th>
              <th> Pin </th>
              <th> Vence </th>
              <th>  Renovar  </th>
              <th> </th>
            </tr>
          </thead>
          <tbody>
           {% for sale in object_list %}
            <tr>
              <td>{{forloop.counter}}</td>
              <td>{{ sale.bill.customer.name }}</td>
              <td>{{ sale.profile.count.platform.name }}</td>
              <td>{{ sale.profile.count.email }}</td>
              <td>{{ sale.profile.count.password }}</td>
              <td>{{ sale.profile.profile }}</td>
              <td>{{ sale.profile.pin }}</td>
              <td>{{ sale.date_limit|date:"d/M/Y" }} / {{ sale.rest_days }} </td>
              <td>
                  <input type="checkbox" class="renew_input" name="{{ sale.id }}"  >
              </td>
               <td>
                 <button type="button" id_profile="{{ sale.profile.id }}" class="btn btn-primary btn-icon-text  btn-danger cut-profile">
                     <i class="mdi mdi-content-cut"></i> Cortar </button>
               </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

     <div class="hide" style="display:none">
        <div class="form-group">
          <label for="months">Meses a renovar:</label>
          <input type="number" id="months" name="months" min="1" max="12">
        </div>
       <button type="submit" class="btn btn-primary mr-2 renew">Renovar</button>
     </div>

    </div>
     </form>
  </div>
</div>
<script>
$('document').ready(function(){
    $('.renew_input').click(function(){
        $('.renew_input').prop('checked',false);
        $(this).prop('checked',true);
    })

    $('.renew_input').change(function(){
        $("#myModal").modal({
             show: true,
             escapeClose: false,
             clickClose: false
        })
        setTimeout(function() {$('.hide').show()}, 500);

        $("#myModal").on('hide.bs.modal', function (e) {
            $('.hide').hide()
             $('.renew_input').prop('checked',false);
        });

    })


    $('body').on("click", ".renew" , function(e){

        e.preventDefault()
        months = $('#months').val()
        if(months != ""){
            $(".sales").submit()
        }else{
            alert("Debe ingresar los meses de renovación")
        }
    })


})
</script>
{% endblock %}
